<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¬ëŸ¬ ê°€ì´ë“œ - AI í¼ìŠ¤ë„ ì»¬ëŸ¬ ì–´ë“œë°”ì´ì €</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="animated-bg">
        {% include 'navigation.html' %}
        <div id="guide" class="page-section active">
            <div class="container" style="padding-top: 100px;">
                <div class="guide-header">
                    <h1>ğŸ¨ ì»¬ëŸ¬ ê°€ì´ë“œ</h1>
                    <p class="subtitle">
                        ê° í¼ìŠ¤ë„ ì»¬ëŸ¬ íƒ€ì…ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ì™€ ìŠ¤íƒ€ì¼ë§ íŒì„ í™•ì¸í•´ë³´ì„¸ìš”.<br>
                        ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                <div id="color-guide-container" class="color-guide-grid">
                    <!-- Color cards will be dynamically generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Template for color cards -->
    <template id="color-card-template">
        <div class="color-card">
            <div class="color-card-header">
                <div class="color-card-preview"></div>
                <div class="color-card-title">
                    <h2></h2>
                    <p></p>
                </div>
                <div class="color-card-toggle">
                    <span>+</span>
                </div>
            </div>
            <div class="color-card-details"></div>
        </div>
    </template>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const descriptions = {
            "Golden": "ë”°ëœ»í•˜ê³  í™œê¸°ì°¬ ê³¨ë“œ ê³„ì—´ ì»¬ëŸ¬ê°€ ì–´ìš¸ë¦¬ë©°, ë°ê³  í™”ì‚¬í•œ ì¸ìƒì„ ì¤ë‹ˆë‹¤.",
            "Warm Beige": "ë¶€ë“œëŸ¬ìš´ ë² ì´ì§€ í†¤ê³¼ ì–´ìš¸ë ¤ ìì—°ìŠ¤ëŸ½ê³  ë”°ëœ»í•œ ë¶„ìœ„ê¸°ë¥¼ ì—°ì¶œí•©ë‹ˆë‹¤.",
            "Muted Clay": "í™ë¹›ì´ ê°ë„ëŠ” ì°¨ë¶„í•œ ì»¬ëŸ¬ë¡œ ìì—°ìŠ¤ëŸ½ê³  ì•ˆì •ì ì¸ ì´ë¯¸ì§€ë¥¼ ì¤ë‹ˆë‹¤.",
            "Warm Apricot": "ìƒí¼í•œ ì‚´êµ¬ë¹›ì´ í”¼ë¶€ í†¤ì„ ë°í˜€ì£¼ë©° í™œê¸°ì°¨ê³  ë”°ëœ»í•œ ë¶„ìœ„ê¸°ë¥¼ ì—°ì¶œí•©ë‹ˆë‹¤.",
            "Peachy Pink": "ëŸ¬ë¸”ë¦¬í•˜ê³  ë°œë„í•œ í•‘í¬ ê³„ì—´ì´ ì˜ ì–´ìš¸ë¦¬ë©°, ìƒê¸° ìˆê³  ìœ ì¾Œí•œ ëŠë‚Œì„ ì¤ë‹ˆë‹¤.",
            "Honey Buff": "ê¿€ë¹›ì²˜ëŸ¼ ë”°ëœ»í•œ ê³¨ë“œ ë² ì´ì§€ ê³„ì—´ë¡œ ê±´ê°•í•˜ê³  ì„¸ë ¨ëœ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.",
            "Beige Rose": "ë¡œì¦ˆë¹›ì´ ê°ë„ëŠ” ë² ì´ì§€ ê³„ì—´ë¡œ ìš°ì•„í•˜ë©´ì„œë„ ë¶€ë“œëŸ¬ìš´ ë§¤ë ¥ì„ ì‚´ë ¤ì¤ë‹ˆë‹¤."
        };

        const koreanNames = {
            "Golden": "ê³¨ë“  íƒ€ì…",
            "Warm Beige": "ì›œ ë² ì´ì§€ íƒ€ì…",
            "Muted Clay": "ë®¤íŠ¸ í´ë ˆì´ íƒ€ì…",
            "Warm Apricot": "ì›œ ì• í”„ë¦¬ì½§ íƒ€ì…",
            "Peachy Pink": "í”¼ì¹˜ í•‘í¬ íƒ€ì…",
            "Honey Buff": "í—ˆë‹ˆ ë²„í”„ íƒ€ì…",
            "Beige Rose": "ë² ì´ì§€ ë¡œì¦ˆ íƒ€ì…"
        };

        // --- Helper Functions ---
        function hexToHSL(hex) {
            hex = hex.replace(/^#/, '');
            let r = parseInt(hex.substring(0, 2), 16) / 255;
            let g = parseInt(hex.substring(2, 4), 16) / 255;
            let b = parseInt(hex.substring(4, 6), 16) / 255;

            let max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                let d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return { h: h * 360, s: s * 100, l: l * 100 };
        }

        // --- Main DOM Logic ---
        const container = document.getElementById('color-guide-container');
        const template = document.getElementById('color-card-template');

        fetch("{{ url_for('static', filename='data/colors.json') }}")
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                if (!container || !template) {
                    console.error('Required elements not found in the DOM');
                    return;
                }

                for (const typeName in data) {
                    if (Object.hasOwnProperty.call(data, typeName)) {
                        const cardFragment = template.content.cloneNode(true);
                        const card = cardFragment.querySelector('.color-card');
                        const colorData = data[typeName];

                        // --- Header ---
                        const previewContainer = card.querySelector('.color-card-preview');
                        colorData.preview.forEach(color => {
                            const swatch = document.createElement('div');
                            swatch.className = 'swatch';
                            swatch.style.backgroundColor = color;
                            previewContainer.appendChild(swatch);
                        });

                        card.querySelector('.color-card-title h2').textContent = koreanNames[typeName] || typeName;
                        card.querySelector('.color-card-title p').textContent = descriptions[typeName] || '';

                        // --- Details ---
                        const detailsContainer = card.querySelector('.color-card-details');
                        for (const category in colorData) {
                            if (category === 'preview') continue;

                            const paletteDiv = document.createElement('div');
                            paletteDiv.className = 'detail-palette';

                            const title = document.createElement('h3');
                            title.textContent = category;
                            paletteDiv.appendChild(title);

                            const swatchesContainer = document.createElement('div');
                            swatchesContainer.className = 'detail-palette-swatches';

                            // âœ… Sort colors by hue first, then lightness (lightest â†’ darkest)
                            const sortedColors = [...colorData[category]].sort((a, b) => {
                                const hslA = hexToHSL(a);
                                const hslB = hexToHSL(b);

                                if (Math.abs(hslA.h - hslB.h) > 5) {
                                    return hslA.h - hslB.h; // sort by hue
                                }
                                return hslB.l - hslA.l; // sort by lightness (ascending)
                            });

                            sortedColors.forEach(color => {
                                const swatch = document.createElement('div');
                                swatch.className = 'swatch';
                                swatch.style.backgroundColor = color;
                                swatch.dataset.color = color; // For tooltip or debugging
                                swatchesContainer.appendChild(swatch);
                            });

                            paletteDiv.appendChild(swatchesContainer);
                            detailsContainer.appendChild(paletteDiv);
                        }

                        container.appendChild(card);
                    }
                }
            })
            .catch(error => {
                console.error('Error fetching or processing color data:', error);
                container.innerHTML = '<p style="text-align: center; color: #c44569;">ì»¬ëŸ¬ ê°€ì´ë“œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
            });

        // Toggle open/close + copy swatch color
        container.addEventListener('click', (e) => {
            // 1) Toggle card open/close
            const header = e.target.closest('.color-card-header');
            if (header) {
                const card = header.parentElement;
                card.classList.toggle('open');
                return; // stop here so clicking header doesn't also trigger swatch copy
            }

            // 2) Copy color when swatch is clicked
            const swatch = e.target.closest('.swatch');
            if (swatch && swatch.dataset.color) {
                navigator.clipboard.writeText(swatch.dataset.color).then(() => {
                    // Optional feedback
                    swatch.classList.add("copied");
                    setTimeout(() => swatch.classList.remove("copied"), 800);
                }).catch(err => {
                    console.error("Clipboard copy failed:", err);
                });
            }
        });

    });
    </script>
</body>
</html>
